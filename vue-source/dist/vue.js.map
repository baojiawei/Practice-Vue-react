{"version":3,"file":"vue.js","sources":["../src/utils.js","../src/observer/array.js","../src/observer/index.js","../src/state.js","../src/compiler/index.js","../src/init.js","../src/index.js"],"sourcesContent":["/**\n * 判断数据是不是对象\n */\nexport function isObject(obj) {\n  return typeof obj === 'object' && obj !== null\n}","// 获取数组原型上的方法\nlet oldArrayMethods = Array.prototype\n// 创建一个全新的对象，可以找到数组原型上的方法, 而且修改对象时不会影响数组原型方法\nexport let arrayMethods = Object.create(oldArrayMethods)\n\n// 这7个方法全部都可以改变原数组\nlet methods = ['push', 'pop', 'unshift', 'sort', 'reverse', 'splice']\n\nmethods.forEach((method) => {\n  // 函数劫持 AOP\n  arrayMethods[method] = function (...args) {\n    const ob = this.__ob__\n    // 当用户调用数组方法时，会先执行我自己改造的逻辑，再执行数组默认的逻辑\n    let result = oldArrayMethods[method].apply(this, args)\n    let inserted\n    // push unshift splice 都可以新增属性 (新增的属性可能是一个对象类型)\n    // 内部还对数组中引用类型也做了一次劫持 [].push({name: 'bjw'})\n    switch (method) {\n      case 'push':\n      case 'unshift':\n        inserted = args\n        break\n      case 'splice': // 也是新增属性，可以修改，可以删除 [].splice(arr, 1, 'div')\n        inserted = args.slice(2)\n      default:\n        break\n    }\n    inserted && ob.observerArray(inserted)\n    return result\n  }\n})\n","import { isObject } from '../utils'\nimport { arrayMethods } from './array'\nclass Observer {\n  constructor(data) {\n    // 相当于在数据上可以获取到__ob__这个属性 指代的是observer实例\n    // __ob__ 是一个响应式的标识，对象数组都有\n    Object.defineProperty(data, '__ob__', {\n      enumerable: false, // 不可枚举\n      configurable: false, // 不可配置\n      value: this\n    })\n    if (Array.isArray(data)) {\n      // 重写数组方法，函数劫持, 改变数组本身的方法，加入监控\n      // 通过原型链 向上查找\n      data.__proto__ = arrayMethods\n      this.observerArray(data)\n    } else {\n      this.walk(data) // 对数据一步步处理\n    }\n  }\n\n  observerArray(data) {\n    for (let i = 0; i < data.length; i++) {\n      observer(data[i])\n    }\n  }\n\n  walk(data) {\n    // 对象的循环 data:{msg: 'bbb', age: 12}\n    Object.keys(data).forEach((key) => {\n      defineReactive(data, key, data[key]) // 定义响应式的数据变化\n    })\n  }\n}\n// vue2的性能 递归重写get和set 一次性递归到底 proxy可以解决\nfunction defineReactive(data, key, value) {\n  observer(value) // 如果传入的值还是一个对象的话，就做递归循环监测\n  Object.defineProperty(data, key, {\n    get() {\n      return value\n    },\n    set(newValue) {\n      if (newValue === value) {\n        return\n      }\n      observer(newValue) // 监控当前设置的值，有可能用户给了一个新值还是对象\n      value = newValue\n    },\n  })\n}\n\nexport function observer(data) {\n  // 对象就是使用defineProperty 来实现响应式原理\n\n  // 如果这个数据不是对象 或者是null 那就不用监控了\n  if (!isObject(data)) {\n    return\n  }\n\n  if(data.__ob__ instanceof Observer) { // 防止对象被重复观测\n    return\n  }\n  // 对数据进行defineProperty\n  return new Observer(data) // 可以看到当前数据是否被观测过\n}\n","import { observer } from './observer/index'\nexport function initState(vm) {\n  const opts = vm.$options\n  if (opts.props) {\n    initProps(vm)\n  }\n  if (opts.methods) {\n    initMethods(vm)\n  }\n  if (opts.data) {\n    initData(vm)\n  }\n}\n\nfunction initProps(vm) {}\n\nfunction initMethods(vm) {}\n\nfunction initData(vm) {\n  // 数据响应式原理\n  let data = vm.$options.data // 用户传入的数据\n  // vm._data是监测后的数据\n  data = vm._data =typeof data === 'function' ? data.call(vm) : data\n  // 观测数据\n  observer(data) // 观测这个数据\n}\n","// 实现模板的编译\n// 模板编译原理\n// 1.先把我们的代码转化成ast语法树 (1)parser解析 (正则)\n// 2.标记静态树 (2) 树得遍历标记markup\n// 3.通过ast产生的语法树 生成代码 => render函数 codegen\nexport function compileToFunctions(template) {\n  \n}","import { initState } from './state'\nimport { compileToFunctions } from './compiler/index'\nexport function initMixin(Vue) {\n  Vue.prototype._init = function (options) {\n    // Vue的内部 $options 就是用户传递的所有参数\n    const vm = this\n    vm.$options = options // 用户传入的参数\n\n    initState(vm) // 初始化状态\n\n    // 需要通过模板渲染\n    if (vm.$options.el) {\n      vm.$mount(vm.$options.el)\n    }\n  }\n  Vue.prototype.$mount = function (el) {\n    // 可能是字符串 也可以传入一个dom对象\n    const vm = this\n    el = document.querySelector(el) // 获取el属性\n    // 如果同时传入 template 和 render 默认会采用render抛弃template，如果都没传\n    // 就使用id=\"app\"中的模板\n    const opts = vm.$options\n    if (!opts.render) {\n      let template = opts.template\n      if (!template && el) {\n        // 应该使用外部的模板\n        template = el.outerHTML\n      }\n      const render = compileToFunctions(template)\n      opts.render = render\n    }\n\n    // 走到这里说明不需要编译了，因为用户传入的就是一个render函数\n  }\n}\n","import {initMixin} from './init'\nfunction Vue(options) {\n  // 内部要进行初始化操作\n  this._init(options)\n}\n\ninitMixin(Vue)\nexport default Vue\n"],"names":["isObject","obj","oldArrayMethods","Array","prototype","arrayMethods","Object","create","methods","forEach","method","ob","__ob__","args","result","apply","inserted","slice","observerArray","Observer","data","defineProperty","enumerable","configurable","value","isArray","__proto__","walk","i","length","observer","keys","key","defineReactive","get","set","newValue","initState","vm","opts","$options","props","initData","_data","call","compileToFunctions","template","initMixin","Vue","_init","options","el","$mount","document","querySelector","render","outerHTML"],"mappings":"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"}